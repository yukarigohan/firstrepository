(import (scheme base) (scheme lazy) (scheme write))

;; Test 1 : delay-force does not make `np` resolved

(define x 0)
(define np (delay (begin
                    (set! x (+ x 1))
                    (if (= x 1) 'ok 'ng))))

(define op (delay-force np))

(force op)
(display (force np))(newline)  ; expected ok but got ng

;; Test 2: reentrancy test

(define flag #f)
(define p (delay (if flag
                   'ok
                   (begin
                     (set! flag #t)
                     (force p)
                     'ng))))
(display (force p))  ; expected ok but got ng
