vim: set ft=scheme:

(begin ((lambda (button cost amount)
          (js-invoke button "setAttribute" "title" (string-append "Gets " (number->string cps) " clicks per second."))
          (define (buy)
            (if (> cost *num-brownies*) (message! (string-append "Insufficient funds! You need " (number->string (2dec cost)) " brownies.")) (begin (set! *num-brownies* (- *num-brownies* cost)) (set-timer! click (/ 1 cps)) (set! amount (+ amount 1)) (set! cost (* price (expt interest amount))) (message! (string-append "Price of " name " now at " (number->string (2dec cost)) " brownies.")) (refresh))))
          (bind-proc-button button buy)
          (define (refresh) (console-log (quote refresh) name) (begin (set! cost (* price (expt interest amount))) (name-button! button (string-append "Buy " name " (" (number->string (2dec cost)) ")"))))
          (define (dispatch m) (if (eq? m (quote refresh)) refresh (if (eq? m (quote buy)) buy (if (eq? m (quote get-amount)) amount null))))
          dispatch)
        (create-button (string-append "Buy " name " (" (number->string price) ")"))
        price
        0))
